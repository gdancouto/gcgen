<!DOCTYPE html>
<html>
<head>
	<title>Baseline graphics</title>
	<style>
		* {
            margin: 0;
            padding: 0;
			overflow:hidden;
            }
            
		.wrap {
			position: relative;
			width: 1280px;
			height: 720px;

			background-color: rgba(75, 75, 0, 0);
			border: 1px solid red;
		}
			
		.bg {
			position: absolute;
			height: 100%;
			width: 100%;
		}

		.layer{
			position: absolute;
			height: 100%;
			width: 100%;
		}

		@keyframes fadeIn {
			0% { opacity: 0; }
			100% { opacity: 1; }
		}

		@keyframes fadeOut {
			0% { opacity: 1; }
			100% { opacity: 0; }
		}

		.fadeIn {
			animation: 500ms ease-out normal both;
			animation-name: fadeIn;
		}

		.fadeOut {
			animation: 500ms ease-out normal both;
			animation-name: fadeOut;
		}

	</style>
</head>

<body>
	<div id="wrapper" class="wrap">
	 <!-- <video id="back" class= "bg" type="video/mp4" controls preload="none" autoplay muted playsinline></video>  -->
	 <!--     <video id="back" class= "bg" type="video/mp4" controls preload="none" autoplay muted playsinline></video>  -->
	</div>
</body>

<script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>

<script>
	/*
	var video = document.getElementById('back');
 	//var videoSrc = 'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8';
	var videoSrc = 'public/teste.m3u8';

	if (Hls.isSupported()) {
		var hls = new Hls();
		hls.loadSource(videoSrc);
		hls.attachMedia(video);
	}
	*/

	/*
	let hls = new Hls({backBufferLength:30, autoStartLoad:false, debug:true});
                hls.loadSource(src);
                hls.attachMedia(v);
                v.addEventListener('play', () => hls.startLoad(), {once:true});
	*/

	/*var ctime = player.currentTime();
	player.currentTime(0);
	player.currentTime(ctime);
	*/

	var absolutePath = function (href) {
		let link = document.createElement("a");
		link.href = href;

		let src = link.href;
		link.remove();
		return src;
	}

	const dataReplicant = nodecg.Replicant('reloadChannel');

	dataReplicant.on('change', (newValue, oldValue) => {
		//set timeout of 1s
		//console.log(newValue);
		//location.reload(true);
	});


	nodecg.listenFor('templateChannel', (template) => {

		let id = template.layer;
		let src = absolutePath (template.src);

		const layer = document.getElementById("layer" + id);

		if (layer == null)
		{
			let iframe = document.createElement('iframe');

			iframe.id = "layer" + id;
			iframe.classList.add("layer");
			iframe.src = src;
			iframe.title = "layer" + id;
			iframe.frameBorder = 0;
			iframe.style = "z-index: " + id;

			wrapper.appendChild(iframe);
		}

		else if (src != layer.src)
			layer.src = src;

	})

	nodecg.listenFor('keyerChannel', (output) => {

		const layers = document.getElementsByClassName("layer");

		for (let layer of layers)
		{
			if (output.on) {
				layer.classList.remove("fadeOut");
				layer.classList.add("fadeIn");
			}

			else {
				layer.classList.remove("fadeIn");
				layer.classList.add("fadeOut");
			}
		}
	});

</script>
</html>