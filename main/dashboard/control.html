<!DOCTYPE html>
<html>
<head>
	<title>Engine Control</title>
	<meta http-equiv="content-type" content="text/html">
	<meta charset="utf-8">

	<link rel="stylesheet" href="css/dashboard.css">
</head>

<body>
	<!--
	<div>
		<label>Splice host:</label>
		<input id="spliceHost" type="text" value="localhost:4040"></input> 
	</div>
	<div>
		<label>Data host:</label>
		<input id="dbHost" type="text" value="localhost:5050"></input>
	</div>
	-->


	<div class="wrapper">
		<div class="title">VIDEO FEED</div>
		<button class="button" id="prevButton">Previous</button>
		<button class="button" id="nextButton">Next</button>
	</div>

	<div class="wrapper">
		<div class="title">FEED MONITOR</div>
		<button class="button" id="openMonitor">Open</button>
	</div>

	 <div class="wrapper">
		<div class="title">LANGUAGE</div>
		<select id="idiomSelect" class="selector">
			<option value=0 selected>English</option>
			<option value=1>Japanese</option>
		</select>
	</div>

	<div class="wrapper">
		<div class="title">FORMAT</div>
		<select id="formatSelect" class="selector">
			<option value=0 selected>Widescreen TV</option>
			<option value=1>Portrait</option>
		</select>
	</div>

	<div class="wrapper">
		<div class="title">KEYER</div>
		<button class="button" id="keyerOn">ON</button>
		<button class="button" id="keyerOff">OFF</button>
	</div>
	
	<!--
	<div class="wrapper">
		<div class="title">KEYER</div>
		<label class="switch">
			<input type="checkbox" id="keyerToggle" checked="true">
		</label>
	</div>
		-->

</body>

<script>
	const idiom = nodecg.Replicant('idiomChannel');
	const format = nodecg.Replicant('formatChannel');

	function dataReceived (object){

		object.classList.add ("blink");

		setTimeout (function (){
			object.classList.remove ("blink");
		},1000);
	}

	prevButton.onclick = () => {
		nodecg.sendMessage('streamChannel', 'prev');
	};

	nextButton.onclick = () => {
		nodecg.sendMessage('streamChannel', 'next');
	};

	openMonitor.onclick = () => {
		nodecg.sendMessage('monitorChannel', '1');
	};

	idiomSelect.onchange = () => {
		idiom.value = idiomSelect.value;
	};

	idiom.on('change', (newValue, oldValue) => {

		if (newValue != oldValue)
			idiomSelect.value = idiom.value;
	});

	formatSelect.onchange = () => {
		format.value = formatSelect.value;
	};

	format.on('change', (newValue, oldValue) => {

		if (newValue != oldValue)
			formatSelect.value = format.value;
	});

	keyerOn.onclick = () => {
		message.output.on = true;
		nodecg.sendMessage('mainChannel', message);
		
	};

	keyerOff.onclick = () => {
		message.output.on = false;
		nodecg.sendMessage('mainChannel',  message);
	};
	
	nodecg.listenFor('keyerChannel', (newValue) => {

		if (newValue.on)
				dataReceived (keyerOn);

		else
				dataReceived (keyerOff);
	});

	// replace this logic to backend
	const message = { 
		output: {
			id: "PGM",
			on: true,
		}
	}

</script>
</html>
